<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tetris (m√≥vil)</title>
<style>
  :root { color-scheme: dark light; }
  body { margin:0; background:#111; color:#eee; font-family: system-ui, -apple-system, sans-serif; display:grid; place-items:center; min-height:100dvh; }
  h1 { margin:16px 0 8px; font-size:28px; }
  #wrap { display:grid; gap:14px; justify-items:center; }
  canvas { background:#000; border:2px solid #ddd; touch-action:none; }
  #controls { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
  #controls button { width:64px; height:64px; border-radius:14px; border:1px solid #444; background:#222; color:#eee; font-size:22px; }
  #hint { opacity:.8; font-size:14px; }
</style>
</head>
<body>
  <div id="wrap">
    <h1>üéÆ Tetris</h1>
    <canvas id="tetris" width="240" height="400"></canvas>
    <div id="controls">
      <button id="left">‚Üê</button>
      <button id="rotate">‚ü≥</button>
      <button id="right">‚Üí</button>
      <button id="soft">‚Üì</button>
      <button id="hard">‚§ì</button>
    </div>
    <div id="hint">Botones o gestos: tap = rotar, swipe ‚Üê/‚Üí = mover, swipe ‚Üì = caer, doble-tap = ca√≠da dura.</div>
  </div>

<script>
const canvas = document.getElementById('tetris');
const ctx = canvas.getContext('2d');
ctx.scale(20, 20);

// --- L√≥gica Tetris (misma que la tuya, sin puntuaci√≥n) ---
function arenaSweep() {
  outer: for (let y = arena.length - 1; y >= 0; --y) {
    for (let x = 0; x < arena[y].length; ++x) if (arena[y][x] === 0) continue outer;
    const row = arena.splice(y, 1)[0].fill(0);
    arena.unshift(row); ++y;
  }
}
function collide(arena, player) {
  const m = player.matrix, o = player.pos;
  for (let y=0;y<m.length;++y) for (let x=0;x<m[y].length;++x) {
    if (m[y][x]!==0 && (arena[y+o.y] && arena[y+o.y][x+o.x])!==0) return true;
  }
  return false;
}
function createMatrix(w,h){ const m=[]; while(h--) m.push(new Array(w).fill(0)); return m; }
function createPiece(t){
  return t==='T'?[ [0,0,0],[1,1,1],[0,1,0] ]:
         t==='O'?[ [2,2],[2,2] ]:
         t==='L'?[ [0,3,0],[0,3,0],[0,3,3] ]:
         t==='J'?[ [0,4,0],[0,4,0],[4,4,0] ]:
         t==='I'?[ [0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0] ]:
         t==='S'?[ [0,6,6],[1,1,0],[0,0,0] ]: // (color 6, forma S)
                  [ [7,7,0],[0,7,7],[0,0,0] ]; // Z
}
function drawMatrix(matrix, off){ matrix.forEach((row,y)=>row.forEach((v,x)=>{ if(v){ ctx.fillStyle=colors[v]; ctx.fillRect(x+off.x,y+off.y,1,1); }})); }
function draw(){ ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height); drawMatrix(arena,{x:0,y:0}); drawMatrix(player.matrix, player.pos); }
function merge(arena, player){ player.matrix.forEach((row,y)=>row.forEach((v,x)=>{ if(v){ arena[y+player.pos.y][x+player.pos.x]=v; }})); }
function playerDrop(){ player.pos.y++; if(collide(arena,player)){ player.pos.y--; merge(arena,player); playerReset(); arenaSweep(); } dropCounter=0; }
function playerMove(d){ player.pos.x+=d; if(collide(arena,player)) player.pos.x-=d; }
function playerReset(){
  const pieces='TJLOSZI';
  player.matrix = createPiece(pieces[pieces.length*Math.random()|0]);
  player.pos.y = 0;
  player.pos.x = (arena[0].length/2|0) - (player.matrix[0].length/2|0);
  if(collide(arena,player)){ arena.forEach(r=>r.fill(0)); }
}
function rotate(m,dir){ for(let y=0;y<m.length;++y) for(let x=0;x<y;++x) [m[x][y],m[y][x]]=[m[y][x],m[x][y]];
  if(dir>0) m.forEach(r=>r.reverse()); else m.reverse();
}
function playerRotate(dir){
  const pos=player.pos.x; let off=1; rotate(player.matrix,dir);
  while(collide(arena,player)){ player.pos.x+=off; off=-(off+(off>0?1:-1)); if(off>player.matrix[0].length){ rotate(player.matrix,-dir); player.pos.x=pos; return; } }
}

let dropCounter=0, dropInterval=1000, lastTime=0;
function update(t=0){ const dt=t-lastTime; lastTime=t; dropCounter+=dt; if(dropCounter>dropInterval) playerDrop(); draw(); requestAnimationFrame(update); }

const colors=[null,'#BA55D3','#FFD700','#FFA500','#4169E1','#00FFFF','#32CD32','#DC143C'];
const arena=createMatrix(12,20);
const player={ pos:{x:0,y:0}, matrix:null };

document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft') playerMove(-1);
  else if(e.key==='ArrowRight') playerMove(1);
  else if(e.key==='ArrowDown') playerDrop();
  else if(e.key==='ArrowUp') playerRotate(1);
  else if(e.code==='Space') { // ca√≠da dura
    while(!collide(arena,player)) player.pos.y++;
    player.pos.y--; merge(arena,player); playerReset(); arenaSweep();
  }
});

// --- Botones t√°ctiles ---
const btn = id => document.getElementById(id);
btn('left').addEventListener('touchstart',e=>{ e.preventDefault(); playerMove(-1); }, {passive:false});
btn('right').addEventListener('touchstart',e=>{ e.preventDefault(); playerMove(1); }, {passive:false});
btn('rotate').addEventListener('touchstart',e=>{ e.preventDefault(); playerRotate(1); }, {passive:false});
btn('soft').addEventListener('touchstart',e=>{ e.preventDefault(); playerDrop(); }, {passive:false});
btn('hard').addEventListener('touchstart',e=>{ e.preventDefault();
  while(!collide(arena,player)) player.pos.y++; player.pos.y--; merge(arena,player); playerReset(); arenaSweep();
}, {passive:false});

// --- Gestos sobre el canvas ---
let t0=null, lastTap=0;
canvas.addEventListener('touchstart',e=>{
  e.preventDefault();
  const t=e.changedTouches[0];
  t0={x:t.clientX,y:t.clientY,time:Date.now()};
  // doble-tap -> hard drop
  if (Date.now()-lastTap<300){ // doble tap
    while(!collide(arena,player)) player.pos.y++; player.pos.y--; merge(arena,player); playerReset(); arenaSweep();
  }
  lastTap=Date.now();
},{passive:false});

canvas.addEventListener('touchmove',e=>{
  e.preventDefault();
},{passive:false});

canvas.addEventListener('touchend',e=>{
  e.preventDefault();
  const t=e.changedTouches[0];
  if(!t0) return;
  const dx=t.clientX - t0.x, dy=t.clientY - t0.y;
  const ax=Math.abs(dx), ay=Math.abs(dy), TH=24; // umbral px
  if (ax<TH && ay<TH){ playerRotate(1); } // tap = rotar
  else if (ax>ay){ playerMove(dx>0?1:-1); } // swipe horizontal
  else { playerDrop(); } // swipe abajo
  t0=null;
},{passive:false});

playerReset(); update();
</script>
</body>
</html>
